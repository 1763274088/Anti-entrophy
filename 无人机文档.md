# 无人机文档

## 嵌入式开发板与飞控

### 嵌入式开发板

* TK1（143克）

  ![img](http://www.synnex.com.tw/oem/IMAGE/nv_word1.gif)

* TX2, TX1（重量143克）
  模块技术规格

  |          | Jetson TX2                                                   | Jetson TX1                                                   |
  | -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | GPU      | NVIDIA Pascal™、256 颗 CUDA 核心                             | NVIDIA Maxwell™、256 颗 CUDA 核心                            |
  | CPU      | HMP Dual Denver 2/2 MB L2 + Quad ARM® A57/2 MB L2            | Quad ARM® A57/2 MB L2                                        |
  | 视频     | 4K x 2K 60 Hz 编码 (HEVC)4K x 2K 60 Hz 解码（12 位支持）     | 4K x 2K 30 Hz 编码 (HEVC)4K x 2K 60 Hz 解码（10 位支持）     |
  | 内存     | 8 GB 128 位 LPDDR458.3 GB/s                                  | 4 GB 64 位 LPDDR425.6 GB/s                                   |
  | 显示器   | 2 个 DSI 接口、2 个 DP 1.2 接口/HDMI 2.0 接口/eDP 1.4 接口   | 2 个 DSI 接口、1 个 eDP 1.4 接口/DP 1.2 接口/HDMI 接口       |
  | CSI      | 超级多 6 个摄像头（2 通道CSI2 D-PHY 1.2（每个通道 2.5 Gbps） | 超级多 6 个摄像头（2 通道）CSI2 D-PHY 1.1（每个通道 1.5 Gbps） |
  | PCIE     | Gen 2 \| 1x4 + 1x1 或 2x1 + 1x2                              | Gen 2 \| 1x4 + 1x1                                           |
  | 数据存储 | 32 GB eMMC、SDIO、SATA                                       | 16 GB eMMC、SDIO、SATA                                       |
  | 其他     | CAN、UART、SPI、I2C、I2S、GPIO                               | UART、SPI、I2C、I2S、GPIO                                    |
  | USB      | USB 3.0 + USB 2.0                                            |                                                              |
  | 连接     | 1 千兆以太网、802.11ac WLAN、蓝牙                            |                                                              |
  | 机械     | 50 毫米 x 87 毫米（400 针兼容板对板连接器）                  |                                                              |

* Pixhawk 2![img](http://www.proficnc.com/img/cms/Front%20Page%202/pixhawk2%E7%94%A2%E5%93%81%E7%89%B9%E6%80%A7_cube+edison.jpg)



#### 嵌入式主板性能对比

 终于有时间给自己的工作做一个总结了，回首往昔，从事SLAM与机器人室内自主导航也两载有余了。机器人是软件硬件结合的一个实体，这里就先从机器人的大脑-嵌入式主板展开讨论，以下是我用过的一些嵌入式开发板，就主要针对性的展开一下对比分析：

* 树莓派3
* Firefly-RK3399
* Nvidia-jetson-TK1
* Nvidia-jetson-TX2
* Intel-NUC
* Intel-Edison
* Google-Tango-phone

##### 树莓派3

之前一直很火的树莓派2大家都知道，如今又出了升级版本（也就是树莓派3），这里就放一张树莓派0，树莓派2，树莓派3家族的合影吧。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325200453125-121336550.png)

接下来看看具体性能参数，了解更多树莓派的知识可以参考《Exploring Raspberry Pi-Interfacing to the Real World with Embedded Linux· Derek Molloy》这本书。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325200540751-893768496.png)

树莓派3，售价200RMB左右，CPU是1.2Ghz ARM-Cortex-A53，内存1GB，板载wifi模块，还有一个多媒体显示GPU（不过感觉没什么用）。CPU和内存配置算的的上是同等价位嵌入式主板的战斗机了，板载wifi这个也很实用。虽然树莓派支持安装很多种linux系统，由于我这里要跑ROS机器人系统，所以我选择了安装ubuntu-mate-16.04, ubuntu-mate-16.04 LTS实际上是ubuntu-16.04 LTS的一部分，为桌面、Raspberry Pi 2和3单片机准备的，这也是Ubuntu MATE的首个LTS长期支持版，亮点在于包含MATE 1.12.1桌面环境，针对平板支持多点触控和“自然滚动”，对多屏幕设置提供更好的支持，更好的会话管理，扩展的systemd支持，改进过的Power小程序——可显示产品型号和提供商信息等内容。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325200607946-459573387.png)

安装好ubuntu-mate-16.04操作系统后，就可以安装kinetic版本的ROS了，最后安装一些cp210x和ch340之类的USB转串口的驱动后，就可以验证SLAM算法了。Gmapping激光SLAM建图和ros-navigation自动导航跑的都很顺畅；google-cartographer进行建图和重定位也没什么问题；跑ORB-SLAM2的Mono模式就不太行了，帧率5帧以内。

##### Firefly-RK3399

萤火虫开发板还是很强大的板子分RK3288和RK3399两个版本，先看一下官方的宣传广告吧。

 ![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325200655897-1977367443.png)![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325200705804-1756727386.png)

RK3399的CPU和内存配置很强大，跑各种视觉算法很不错，不过售价1000RMB感觉有点小贵。

##### Nvidia-jetson-TK1

**![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325200749131-1350852936.png)**

Tegra K1是Nvidia推出的一款AI级别的嵌入式主板，ARM-Cortex-A15的CPU，192个CUDA核心的kepler架构的GPU，2GB内存。有人用Tegra K1做了一个计算集群，感觉还挺有意思的。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325200821043-2058146315.png)

##### Nvidia-jetson-TX2

Jetson TX2的是可以作为核武器的处理器的（@~@），性能是十分强大的。简单的智能小车或者机器人不推荐使用TX2，性价比比较低。利用TX2做处理器，控制移动平台（高精度的小车底盘）做SLAM我觉得是一个相当有意思的项目，TX2的处理能力非常适合实现机器视觉。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325200946958-764340157.png) ![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201003493-2104081697.png)

左图是官方的开发板和扩展板，不过由于官方扩展板体积太大了用在很多地方不方便，于是网上推出了一款小巧的扩展板Connect Tech Inc.很不错。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201029134-1979950344.png)

这个是性能表，看上去也是叼叼的，不过售价不便宜接近5000RMB。。。

##### Intel-NUC

前面介绍的都是ARM架构的主板，现在介绍一款X86架构的主板NUC。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201052705-782925822.png)

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201110065-2139841657.png)

之前用过Intel-NUC7-i7,19V供电65W功耗感觉不适合嵌入式级别的应用场合，而且3000RMB的售价也没法和Nvidia-jetson-TX2比较性价比，所以不推荐在机器人上使用。

##### Intel-Edison

其实这是intel一个失败的尝试，主打物联网应用，CPU采用intel的Atom处理器，最大的亮点是可以在主板上直接扩展Ardunio单片机开发板。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201149682-296715201.png)

其实个人不推荐用Edison来开发SLAM算法，不过也有公司做这方面的尝试，比如上海思岚科技的SLAMWARE CORE就是Edison的模仿者。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201223175-995196351.png)

##### Google-Tango-phone

其实Tango-phone是一个完整的AR方案，手机内集成了深度相机和VO视觉里程计。

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201251784-129996908.png) ![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201259155-797171860.png)

看网上的演示视频也是十分的炫酷，不过最终这个项目还是没有在google中火起来，可能还是存在不少问题的吧。

##### 总结

![img](https://images2018.cnblogs.com/blog/1204799/201803/1204799-20180325201338422-1973913021.png)

所以，最后总结一下，玩机器人和SLAM的朋友们，如果是中低端需求推荐树莓派3，高端需求推荐jetson-TX2。

#### 嵌入式开发板区别讨论

 谢邀。楼主说的三种开发板基本上属于两类：大疆的妙算和TK1基本上属于一类，Intel的属于第二类。先说妙算吧，妙算其实就是==英伟达TK1+自定义接口+大疆的SDK==。楼下实验室在用，我在TK1上写的程序直接拷贝过去就能用，楼下的师弟说因为妙算基本就是买了英伟达的板子回来DIY导致英伟达告大疆侵权，所以现在买一块妙算都相当麻烦，所有的网上社区也下线了（怎么感觉和偷偷买一样）。。扯远了，妙算的好处就是==集成大疆onboard飞控==，如果你飞控用的是大疆系列的那开发起来会容易很多。但考虑到楼主不是用的==M100==，实际能简化多少我就无从而知了。
然后说TK1， TK1的话现在可能是最经济实惠的硬件了。GPU加速虽然比不上TX1， 但是有总比没有好吧~最方便的就是系统是==桌面级的Ubuntu==，电脑上写好的程序放到板子上编译一下就好，不用再担心==头疼的交叉编译==（其实楼主的这三个选择都不需要考虑）。但是TK1的缺点在于接口少，==两个USB口相机占掉一个==就不够了啊……串口倒是够多，但是收发数据两个也就够了，多了也用不到。所以这点上，妙算DIY的就很好。
再说Intel的芯片，在飞机上用英特尔的芯片也很多，但是！！小型四旋翼有个最大的问题就是：功耗。隔壁实验室做视觉跟踪就是用的Intel的单板，功耗跟不上导致芯片性能不能满负荷运行……不过Intel的芯片有个好处，就是你可以装Windows啊……很多人对Ubuntu（Linux内核系统）的命令行深恶痛绝，其实熟悉起来还好，但是我相信楼主做图像处理肯定是从VS+OpenCV入门的（因为我也是^_^）所以对Windows开发的熟悉程度肯定好于LINUX。但个人觉得Windows效率还是太低，入门可以，但是最后工程化的话还是要上Linux。
总之我推荐TK1（RMB1500），性价比最高，如果是大疆的飞控经费充裕的话可以上妙算（RMB6000）。真的实在没时间折腾Ubuntu的话就用Intel的芯片吧……

TK1购买教育优惠：http://www.nvidia.com/object/tk1-edu-discount.html

#### 嵌入式开发板核心对比

核心对比

Cortex A5: 1.57 DMIPS/MHz 每核心
Cortex A7: 1.9
Cortex A8: 2.0
Cortex A9: 2.5
Cortex A12: 3.0
Cortex A15: 3.5起，可高到4.01
Cortex A17: 应该与A12相当
Cortex A53 (64位): 2.3
Cortex A57 (64位): 4.1起，可高到4.76

![img](https://pic4.zhimg.com/80/v2-d3874af5dbbae1833d793435cbb7b164_hd.jpg)

#### Pixhawk2

Pixhawk2采用STM32F4处理器和Intel-Edison



### 飞控

#### 为什么飞控和开发板要分开

如果我们只关注于飞行，目前基于cortex-M4内核的单片机，如大部分开源飞控使用的==STM32F4处理器==，168MHz主频，带有==单精度浮点运算单元==，性能已经完全满足飞控的要求了。性能更强大的基于M7内核单片机发布了也有一些日子了，现在已经有了在四轴飞行器上的应用。但如果需要跑一些对处理器性能要求更加高的上层业务，如图像识别处理，那一个高性能的==高主频多核处理器==是必不可少的。

**所以总结一下**，一个飞控未必只存在一个处理器，随着我们对飞行器的智能化要求越来越高，未来一个完整的飞控系统应该包括==运行linux的高性能处理器+跑RTOS的单片机==，一个负责视频和语音信号处理等上层业务，一个负责惯性导航和姿态控制等下层业务。然后这两个系统之间存在着通信，如视频信号经过识别处理后得到结果，再将指令发送给下层处理器，该指令经过底层处理器的控制回路后最终才表现为对四轴飞行器的电机的控制。

#### Arduino、ARM、树莓派、单片机四者有什么不同？

凯美瑞，V型发动机，帕萨特，小轿车

简单地说：

1. Arduino是一种开发工具软件，不是一种芯片。它可以支持很多种处理器芯片的开发，内部有很多库，开发软件方便。
2. ARM是英国的一个公司，主要设计ARM系列的处理器。ARM系列处理器是32位处理器，是芯片，不是软件，是很流行的芯片。三星，苹果等很多公司都买ARM公司的授权。
3. 树莓派是一种电路板子。它使用ARM处理器芯片，和linux操作系统或windows操作系统，是一个很小体积的桌面电脑。
4. 单片机是指处理器内核加了一些外围接口电路，做到一个芯片中，也叫微控制器MCU。8051芯片,avr芯片,arm芯片...都叫单片机，而英特尔的80x86系列是中央处理器，不能叫单片机。

复杂地说：

1. Arduino是平台
   Arduino只是一个用java和gnu实现的、开源的开发平台，其结构源于Processing。它可以支持多种MCU，包括atmel公司的AtmelTiny系列、avr8、ARM Cortex M0、ARM Cortex M3、ST公司的ARM Cortex M3,TI公司的energia平台也采用了Arduino的平台结构，可以用于开发MSP430、C2000等。从原理上，Arduino平台不受MCU限制，但是当前只是支持有限的MCU。当前已经支持有名的ESP8266,ESP32等ARM内核板开发。
2. 硬件抽象层HAL
   Arduino有一个硬件抽象层，实现了硬件无关层和硬件相关层的分离。
3. 编程语言
   Arduino采用C和C++混合编程，采用成熟的开源gnu来编译。
4. 类库和例子
   Arduino有大量的类库支持，同时从简到繁有大量的应用例子，可以很快地基于类库和例子实现用户的应用。但是如果想了解底层的实现，也可以看到底层实现的源码。
5. 应用
   Arduino主要用于前端的以控制为主的环境，如机器人控制前端，四轴飞行器前端控制，3D打印机前端控制等。对简单的控制系统，只用Arduino开发就可以了。
6. 对比
   1. Arduino是平台，不是某种MCU
   2. ARM只是ARM系列的MCU
   3. 树莓派是基于ARM和linux或windows操作系统的卡片式电脑,可以用于计算量大的环境，可以作为一个通用计算机来用，也可以用于复杂控制系统的后端数据处理和GUI，像一个很小的PC机。
   4. 单片机也是指某种MCU，只是叫法不同。

##### 先说说Arduino

Arduino是一款便捷灵活、方便上手的开源电子原型平台，包含硬件（各种型号的Arduino板）和软件（Arduino IDE)。它适用于爱好者、艺术家、设计师和对于“互动”有兴趣的朋友们。（来源百度百科）

通俗的讲：arduino就是主要以以AVR单片机为核心控制器的单片机应用开发板（当然也有其他核心的例如STM32版本的但是不是官方的，还有intel的伽利略），或者是学习板啥的，但是Arduino开发人员开发了简单的函数，还有许多应用库，这样就不用直接去操作寄存器了，使得没有很好的单片机基础的人员也可以使用Arduino做出自己想要的东西。Arduino的开发人员还开发了一个简洁的IDE（集成开发环境）也就是写代码，编译，调试，下载的上位机软件。

##### 再说ARM

ARM处理器是Acorn计算机有限公司面向低预算市场设计的第一款RISC微处理器

通俗的讲：ARM是一款处理器也可以说是单片机，是功能比较强大的单片机。ARM也是公司的名字

但是值得注意的是ARM公司通过出售芯片技术授权

也就是说ARM公司不做芯片的生产，只有买了这些技术授权的半导体公司才做芯片

我的个人理解是ARM提供处理器的核心技术方案，各个半导体公司加上自己的外设等等东西做成自己的芯片，所有采用arm提供技术授权的芯片都叫ARM

##### 说说树莓派

树莓派由注册于英国的慈善组织“Raspberry Pi 基金会”开发，Eben·Upton/埃·厄普顿为项目带头人。2012年3月，英国剑桥大学埃本·阿普顿（Eben Epton）正式发售世界上最小的台式机，又称卡片式电脑，外形只有信用卡大小，却具有电脑的所有基本功能，这就是Raspberry Pi电脑板，中文译名"树莓派"。这一基金会以提升学校计算机科学及相关学科的教育，让计算机变得有趣为宗旨。基金会期望这 一款电脑无论是在发展中国家还是在发达国家，会有更多的其它应用不断被开发出来，并应用到更多领域。在2006年树莓派早期概念是基于Atmel的 ATmega644单片机，首批上市的10000“台”树莓派的“板子”，由中国台湾和大陆厂家制造。

树莓派就是将你电脑机箱里的大部分东西都集成到了一块电路板上的 微型电脑，接上显示器鼠标键盘等等 东西 和你的电脑没啥实质的区别，操作系统不一样这个是基于linux的系统。

##### 说说单片机

单片机（Microcontrollers）是一种集成电路芯片，是采用超大规模集成电路技术把具有数据处理能力的中央处理器CPU、随机存储器RAM、只读存储器ROM、多种I/O口和中断系统、定时器/计数器等功能（可能还包括显示驱动电路、脉宽调制电路、模拟多路转换器、A/D转换器等电路）集成到一块硅片上构成的一个小而完善的微型计算机系统，在工业控制领域广泛应用。从上世纪80年代，由当时的4位、8位单片机，发展到现在的300M的高速单片机。

单片机在国外叫MCU 微型控制器

就是将CPU RAM ROM 等等集成到一块芯片上构成 单片微型计算机

##### 总结：

Arduino：简单的完善的资源丰富开源的单片机应用开发板

ARM：高性能单片机（简单理解）

树莓派：微型卡片计算机

单片机：单芯片计算机

#### 飞控细节

1. 飞控不是必须要有实时操作系统，可以裸跑，但==绝不能使用非实时系统==。原因是要想达到比较好的控制效果，飞控中的姿态解算环节（计算飞行器姿态）和内环控制环节（角速度环）要求达到==毫秒级的频率==，常用的控制频率为400Hz，如pixhawk飞控，即==2.5ms运行一次控制算法并输出控制信号给电机==。而**姿态解算和飞行控制**作为飞行器最重要的运行进程，是决不允许被打断或延迟的（优先级为最高），否则将会导致飞行器的坠毁。

当然控制频率再低一点，也是可以飞行的，如非常流行的APM开源飞控，由于其最初使用的AVR主控（8位单片机）性能的限制，姿态与控制线程的运行频率只有100Hz，也就是说，==如果能保证10ms一次的实时任务调度，linux也是可以勉强胜任飞控的工作的==。
相关问题：[RTOS在多旋翼飞控中的应用情况？ - 王文天的回答](http://www.zhihu.com/question/28981423/answer/51314550)

2. 实际上上述所说的APM飞控的官方代码就已经有了对linux平台的移植，可以运行于树莓派上，但是由于原本树莓派上的运行的linux系统是非实时的，还需要打一个RT-patch补丁。（树莓派可以兼任飞控但性能不好）
3. 从硬件上来讲，飞控输出PWM信号用于控制电机（经过电调），而大部分基于linux系统的板子应该是==不会带硬件PWM输出==的吧，即使可以GPIO软件模拟PWM信号，但是==性能效率也会打折扣==。抛开这些不谈，使用linux系统跑飞控程序也是完全没有必要的。即使打了实时补丁，linux的实时性相对于其它RTOS也是有很大的差别的，而且linux相对过于庞大复杂，降低了飞控系统的可靠性，对于飞行器而言，有什么比安全还要重要呢？

## 保护罩

![a3.jpg](http://photo.5imxbbs.com/forum/201705/07/182544b03aaqa86r77d0sr.jpg)

![a21.jpg](http://photo.5imxbbs.com/forum/201705/07/182614zzzc0051jzdx1x3c.jpg)




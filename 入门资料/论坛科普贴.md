# 论坛信息

一个小型高集成度的多旋翼飞控可以分为四大部分：**硬件层、软件驱动层、飞行状态感知与控制层、飞行任务层**
**硬件层：**指飞控的实体部分，其中包含==主控制器，陀螺仪、加速度和磁力计==等各类传感器，信号输入与输出接口等；
**软件驱动层：**指主控制器正常运行所需要的软件程序，以及在上面运行的==实时操作系统（RTOS），还有各类传感器的驱动程序==；
**飞行感知与控制层：**多旋翼要实现飞行功能，首先需要正确感知==自身的飞行状态==，包括三维姿态、速度和位置，得到飞行状态后，再通过控制算法，实现对==姿态、速度和位置==的闭环反馈控制；
**飞行任务层：**通常来讲，我们的最终目的并不只是让飞机飞起来，停在空中就完了。而是要让飞机去执行各种任务，常见的有航拍、编队、测绘、植保等，这个过程中，需要我们人为地给飞机发送飞行指令或者预先编写好任务程序。



**飞控的大脑**：主控制器，好比人类的大脑或者电脑的CPU，基本上所有工作都在这上面进行。根据最终产品的体积大小及成本，还有飞控程序所需运算能力的综合评判，通常我们会选择一款合适的==单片机（MCU）==作为飞控主控。

回顾开源飞控的发展历史，可以看到，飞控主控从8位的Atmel AVR单片机发展到了==32位的ARM-Cortex-M核单片机==，从Cortex-M3到M4，最后到了M7，综合性能愈发强大，从M4内核开始增加的==浮点运算单元==，极大地提升了单片机的运算能力，使其基本能满足飞控的高频率计算需求。而早期基于8位机的飞控，运算频率和控制频率不到100Hz，而现在基本达到==500Hz==或更高。
目前综合成本及性能来看，Cortex-M4的单片机最适合做飞控主控，其中使用最广泛的，便是意法半导体的STM32F4系列。如果追求高性能，如DJI在最新几款新产品上面，均使用了==Atmel的Cortex-M7核的单片机==。在ST单片机中，M4内核的F3系列及F41X系列在追求小体积和低成本的情况下也不失为一个好选择。

其次则是**各类传感器**，飞控上常用的有==陀螺仪、加速度计、磁力计、气压计、GPS及视觉传感器==，它们好比人类的眼睛、耳朵、鼻子、皮肤，给人提供了视觉、听觉、嗅觉、触觉，如果失去了这些感觉，我们无从感知自身的状态位置以及外界环境信息，从而失去了最基本的行动能力。飞控上的众多传感器正是起到这些作用，其中陀螺仪测量*角速度*，加速度计测量*加速度*（包括了重力加速度和运动加速度），磁力计可以测量*地球磁场强度*，从而求出飞机航向，而气压计测量*气压强度*，根据特定公式转换成相对高度，最后GPS及视觉传感器可以测量出*飞机绝对和相对速度/位置信息*。

传感器的选型相对于主控而言，则要丰富得多。在低成本的多旋翼飞控上面，通常我们选择使用的是小体积低成本的**MEMS传感器**（IMU）。

首先是最重要的核心传感器陀螺仪与加速度计，为了缩小体积和减少陀螺仪与加速度计安装时产生的轴间误差（两者不在同一个坐标系上），IC厂商们选择了把陀螺仪和加速度计封装在一个芯片上，也就是俗称的六轴传感器（三轴陀螺仪+三轴加速度计），从早期及其流行的应美盛的MPU6050到后来的MPU6500，再发展到ICM系列如ICM20608，ICM20602等，不过从实际测试来看，后续的传感器在某些性能上均没有多大提升，反而有所降低。同类产品还有ST、博世等厂商的，但在实际多旋翼飞控产品上应用较少。这一类六轴传感器性能一般，但价格非常便宜，IC的淘宝零售价不含税基本都在10元以内。而更高端的有ADI公司的ADIS系列陀螺仪，售价从几百到上万不等，大多数市面上可见的所谓工业级飞控均使用此类陀螺仪。

